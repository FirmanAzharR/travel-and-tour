<section id="travel-bandara" class="contact section light-background">
   <!-- Section Title -->
   <div class="container section-title" data-aos="fade-up">
      <h2>Booking Travel Bandara</h2>
      <p>Necessitatibus eius consequatur ex aliquid fuga eum quidem sint consectetur velit</p>
   </div>
   <!-- End Section Title -->
   <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="row g-4 g-lg-12">
         <div class="col-lg-12">
            <div class="contact-form" data-aos="fade-up" data-aos-delay="300">
               <h3>Get In Touch</h3>
               <p>Praesent sapien massa, convallis a pellentesque nec, egestas non nisi. Vestibulum ante ipsum primis.
               </p>
               <!-- Nav tabs -->
               <style>
                  .nav-tabs .nav-link.active {
                  font-weight: bold;
                  }
               </style>
               <ul class="nav nav-tabs mb-3" id="bookingTab" role="tablist">
                  <li class="nav-item" role="presentation">
                     <button class="nav-link active" id="antar-bandara-tab" data-bs-toggle="tab" data-bs-target="#antar-bandara" type="button" role="tab" aria-controls="antar-bandara" aria-selected="true">Antar ke Bandara</button>
                  </li>
                  <li class="nav-item" role="presentation">
                     <button class="nav-link" id="jemput-bandara-tab" data-bs-toggle="tab" data-bs-target="#jemput-bandara" type="button" role="tab" aria-controls="jemput-bandara" aria-selected="false">Jemput dari Bandara</button>
                  </li>
                  <li class="nav-item" role="presentation">
                     <button class="nav-link" id="antar-jemput-bandara-tab" data-bs-toggle="tab" data-bs-target="#antar-jemput-bandara" type="button" role="tab" aria-controls="antar-jemput-bandara" aria-selected="false">Pulang Pergi ke Bandara</button>
                  </li>
               </ul>
               <!-- Tab panes -->
               <div class="tab-content" id="bookingTabContent">
                  <div class="tab-pane fade show active" id="antar-bandara" role="tabpanel" aria-labelledby="antar-bandara-tab">
                     <!-- Form Antar ke Bandara -->
                     <form id="booking-travel-bandara-form" data-aos="fade-up" data-aos-delay="200">
   
                        <div class="row gy-4">
                           <div class="col-md-4">
                              <label for="name">Enter your name</label>
                              <input type="text" name="name" id="name" class="form-control" placeholder="Your Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your name">
                           </div>
                           <div class="col-md-4 ">
                              <label for="wa-number">Enter your whatsapp number</label>
                              <input type="wa-number" class="form-control" name="wa-number" id="wa-number" placeholder="Your Whatsapp Number" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your whatsapp number">
                           </div>
                           <div class="col-md-4 ">
                              <label for="total-passengers">Total passengers</label>
                              <input type="text" class="form-control" name="total-passengers" id="total-passengers" placeholder="Total passengers" required data-bs-toggle="tooltip" data-bs-placement="top" title="Total passengers">
                           </div>
                           <div class="col-md-6 ">
                              <label for="pickup-address">Pickup address location</label>
                              <input type="text" class="form-control" name="pickup-address" id="pickup-address" placeholder="Copy your pickup address from google maps" required data-bs-toggle="tooltip" data-bs-placement="top" title="Pickup address location">
                           </div>
                           <div class="col-md-6 ">
                              <label for="airport-name">Airport Name</label>
                              <input type="text" class="form-control" name="airport-name" id="airport-name" placeholder="Airport Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Airport Name">
                           </div>
                           <div class="col-md-4 ">
                              <label for="booking-date">Enter your booking date</label>
                              <input type="date" class="form-control" name="booking-date" id="booking-date" placeholder="Booking Date" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your booking date">
                           </div>
                           <div class="col-md-4 ">
                              <label for="pickup-time">Pickup time</label>
                              <input type="text" class="form-control" name="pickup-time" id="pickup-time" placeholder="Pickup time" required data-bs-toggle="tooltip" data-bs-placement="top" title="Pickup time">
                           </div>
                           <div class="col-md-4 ">
                              <label for="flight-time">Flight time</label>
                              <input type="text" class="form-control" name="flight-time" id="flight-time" placeholder="Flight time" required data-bs-toggle="tooltip" data-bs-placement="top" title="Flight time">
                           </div>
                           <div class="col-md-4 ">
                              <label for="flight-number">Flight number</label>
                              <input type="text" class="form-control" name="flight-number" id="flight-number" placeholder="Flight number" required data-bs-toggle="tooltip" data-bs-placement="top" title="Flight number">
                           </div>
                           <div class="col-md-4 ">
                              <label for="services">Services</label>
                              <input type="text" class="form-control" name="services" id="services" placeholder="Services" required data-bs-toggle="tooltip" data-bs-placement="top" title="Services">
                           </div>
                           <div class="col-md-4 ">
                              <label for="box">Barang Bagasi</label>
                              <input type="text" class="form-control" name="box" id="box" placeholder="Barang Bagasi" required data-bs-toggle="tooltip" data-bs-placement="top" title="Barang Bagasi">
                           </div>
                           <br>
                           <div class="col-12 text-center">
                              <button type="submit" class="btn">Booking Now</button>
                           </div>
                        </div>
                     </form>
                  </div>
                  <div class="tab-pane fade" id="jemput-bandara" role="tabpanel" aria-labelledby="jemput-bandara-tab">
                     <!-- Form Jemput dari Bandara -->
                     <form id="booking-travel-bandara-pickup-form" data-aos="fade-up" data-aos-delay="200">
                        <div class="row gy-4">
                           <div class="col-md-4">
                              <label for="name">Enter your name</label>
                              <input type="text" name="name" id="name" class="form-control" placeholder="Your Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your name">
                           </div>
                           <div class="col-md-4 ">
                              <label for="wa-number">Enter your whatsapp number</label>
                              <input type="wa-number" class="form-control" name="wa-number" id="wa-number" placeholder="Your Whatsapp Number" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your whatsapp number">
                           </div>
                           <div class="col-md-4 ">
                              <label for="total-passengers">Total passengers</label>
                              <input type="text" class="form-control" name="total-passengers" id="total-passengers" placeholder="Total passengers" required data-bs-toggle="tooltip" data-bs-placement="top" title="Total passengers">
                           </div>
                           <div class="col-md-6 ">
                              <label for="pickup-address">Pickup address location</label>
                              <input type="text" class="form-control" name="pickup-address" id="pickup-address" placeholder="Copy your pickup address from google maps" required data-bs-toggle="tooltip" data-bs-placement="top" title="Pickup address location">
                           </div>
                           <div class="col-md-6 ">
                              <label for="airport-name">Airport Name</label>
                              <input type="text" class="form-control" name="airport-name" id="airport-name" placeholder="Airport Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Airport Name">
                           </div>
                           <div class="col-md-6 ">
                              <label for="booking-date">Enter your booking date</label>
                              <input type="date" class="form-control" name="booking-date" id="booking-date" placeholder="Booking Date" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your booking date">
                           </div>
                           <div class="col-md-6 ">
                              <label for="arrival-time">Arrival time</label>
                              <input type="text" class="form-control" name="arrival-time" id="arrival-time" placeholder="Flight time" required data-bs-toggle="tooltip" data-bs-placement="top" title="Flight Arrival time">
                           </div>
                           <div class="col-md-4 ">
                              <label for="flight-number">Flight number</label>
                              <input type="text" class="form-control" name="flight-number" id="flight-number" placeholder="Flight number" required data-bs-toggle="tooltip" data-bs-placement="top" title="Flight number">
                           </div>
                           <div class="col-md-4 ">
                              <label for="services">Services</label>
                              <input type="text" class="form-control" name="services" id="services" placeholder="Services" required data-bs-toggle="tooltip" data-bs-placement="top" title="Services">
                           </div>
                           <div class="col-md-4 ">
                              <label for="box">Barang Bagasi</label>
                              <input type="text" class="form-control" name="box" id="box" placeholder="Barang Bagasi" required data-bs-toggle="tooltip" data-bs-placement="top" title="Barang Bagasi">
                           </div>
                           <br>
                           <div class="col-12 text-center">
                              <button type="submit" class="btn">Booking Now</button>
                           </div>
                        </div>
                     </form>
                  </div>
                  <div class="tab-pane fade" id="antar-jemput-bandara" role="tabpanel" aria-labelledby="antar-jemput-bandara-tab">
                     <!-- Form Pulang Pergi ke Bandara -->
                     <form id="booking-travel-bandara-pp-form" data-aos="fade-up" data-aos-delay="200">
                        <div class="row gy-4">
                           <div class="col-md-4">
                              <label for="name">Enter your name</label>
                              <input type="text" name="name" id="name" class="form-control" placeholder="Your Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your name">
                           </div>
                           <div class="col-md-4 ">
                              <label for="wa-number">Enter your whatsapp number</label>
                              <input type="wa-number" class="form-control" name="wa-number" id="wa-number" placeholder="Your Whatsapp Number" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your whatsapp number">
                           </div>
                           <div class="col-md-4 ">
                              <label for="total-passengers">Total passengers</label>
                              <input type="text" class="form-control" name="total-passengers" id="total-passengers" placeholder="Total passengers" required data-bs-toggle="tooltip" data-bs-placement="top" title="Total passengers">
                           </div>
                           <div class="col-md-6 ">
                              <label for="pickup-address">Pickup address location</label>
                              <input type="text" class="form-control" name="pickup-address" id="pickup-address" placeholder="Copy your pickup address from google maps" required data-bs-toggle="tooltip" data-bs-placement="top" title="Pickup address location">
                           </div>
                           <div class="col-md-6 ">
                              <label for="airport-name">Airport Name</label>
                              <input type="text" class="form-control" name="airport-name" id="airport-name" placeholder="Airport Name" required data-bs-toggle="tooltip" data-bs-placement="top" title="Airport Name">
                           </div>
                           <div class="col-md-6 ">
                              <label for="booking-date">Enter your booking date</label>
                              <input type="date" class="form-control" name="booking-date" id="booking-date" placeholder="Booking Date" required data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your booking date">
                           </div>
                           <div class="col-md-6 ">
                              <label for="pickup-time">Pickup time</label>
                              <input type="text" class="form-control" name="pickup-time" id="pickup-time" placeholder="Pickup time" required data-bs-toggle="tooltip" data-bs-placement="top" title="Pickup time">
                           </div>
                           <br>
                           <div class="col-12 text-center">
                              <button type="submit" class="btn">Booking Now</button>
                           </div>
                        </div>
                     </form>
                  </div>
               </div>
               <script>
                  document.addEventListener('DOMContentLoaded', function () {
                    // AJAX submit untuk form antar-bandara
                    const bandaraForm = document.getElementById('booking-travel-bandara-form');
                    if (bandaraForm) {
                      bandaraForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const submitBtn = bandaraForm.querySelector('button[type="submit"]');
                        const originalText = submitBtn.textContent;
                        submitBtn.textContent = 'Processing...';
                        submitBtn.disabled = true;
                        const formData = new FormData(bandaraForm);
                        Swal.fire({
                          title: 'Processing...',
                          allowOutsideClick: false,
                          didOpen: () => { Swal.showLoading(); }
                        });
                        for (let pair of formData.entries()) {
                          console.log(pair[0]+ ': ' + pair[1]);
                        }
                        fetch('<?= base_url('booking/booking_travel_bandara') ?>', {
                          method: 'POST',
                          body: formData
                        })
                        .then(response => response.text())
                        .then(html => {
                          let success = false;
                          let message = 'Booking berhasil disimpan!';
                          let htmlMessage = '';
                          if (html.includes('Booking berhasil disimpan')) {
                            success = true;
                          } else if (html.includes('Gagal menyimpan booking')) {
                            // Ambil semua baris error setelah 'Gagal menyimpan booking.'
                            const lines = html.split('\n');
                            if (lines.length > 1) {
                              // Baris pertama pesan utama, sisanya detail error
                              message = lines[0];
                              const errorList = lines.slice(1).filter(e => e.trim() !== '');
                              if (errorList.length > 0) {
                                htmlMessage = '<ul style="text-align:left">' + errorList.map(e => '<li>' + e + '</li>').join('') + '</ul>';
                              }
                            } else {
                              message = html;
                            }
                          }
                          Swal.fire({
                            icon: success ? 'success' : 'error',
                            title: success ? 'Sukses!' : 'Gagal!',
                            text: message,
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                          if (success) bandaraForm.reset();
                        })
                        .catch(() => {
                          Swal.fire({
                            icon: 'error',
                            title: 'Terjadi Kesalahan!',
                            text: 'Terjadi kesalahan. Silakan coba lagi.',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                        })
                        .finally(() => {
                          submitBtn.textContent = originalText;
                          submitBtn.disabled = false;
                        });
                      });
                    }
                    // AJAX submit untuk form pulang-pergi bandara
                    const bandaraPPForm = document.getElementById('booking-travel-bandara-pp-form');
                    if (bandaraPPForm) {
                      bandaraPPForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const submitBtn = bandaraPPForm.querySelector('button[type="submit"]');
                        const originalText = submitBtn.textContent;
                        submitBtn.textContent = 'Processing...';
                        submitBtn.disabled = true;
                        const formData = new FormData(bandaraPPForm);
                        Swal.fire({
                          title: 'Processing...',
                          allowOutsideClick: false,
                          didOpen: () => { Swal.showLoading(); }
                        });
                        for (let pair of formData.entries()) {
                          console.log(pair[0]+ ': ' + pair[1]);
                        }
                        fetch('<?= base_url('booking/booking_travel_bandara_pp') ?>', {
                          method: 'POST',
                          body: formData
                        })
                        .then(response => response.text())
                        .then(html => {
                          let success = false;
                          let message = 'Booking berhasil disimpan!';
                          let htmlMessage = '';
                          if (html.includes('Booking berhasil disimpan')) {
                            success = true;
                          } else if (html.includes('Gagal menyimpan booking')) {
                            // Ambil semua baris error setelah 'Gagal menyimpan booking.'
                            const lines = html.split('\n');
                            if (lines.length > 1) {
                              message = lines[0];
                              const errorList = lines.slice(1).filter(e => e.trim() !== '');
                              if (errorList.length > 0) {
                                htmlMessage = '<ul style="text-align:left">' + errorList.map(e => '<li>' + e + '</li>').join('') + '</ul>';
                              }
                            } else {
                              message = html;
                            }
                          }
                          Swal.fire({
                            icon: success ? 'success' : 'error',
                            title: success ? 'Sukses!' : 'Gagal!',
                            html: htmlMessage ? ('<div>' + message + htmlMessage + '</div>') : message,
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                          if (success) bandaraPPForm.reset();
                        })
                        .catch(() => {
                          Swal.fire({
                            icon: 'error',
                            title: 'Terjadi Kesalahan!',
                            text: 'Terjadi kesalahan. Silakan coba lagi.',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                        })
                        .finally(() => {
                          submitBtn.textContent = originalText;
                          submitBtn.disabled = false;
                        });
                      });
                    }
                    // AJAX submit untuk form jemput-bandara
                    const bandaraPickupForm = document.getElementById('booking-travel-bandara-pickup-form');
                    if (bandaraPickupForm) {
                      bandaraPickupForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        const submitBtn = bandaraPickupForm.querySelector('button[type="submit"]');
                        const originalText = submitBtn.textContent;
                        submitBtn.textContent = 'Processing...';
                        submitBtn.disabled = true;
                        const formData = new FormData(bandaraPickupForm);
                        Swal.fire({
                          title: 'Processing...',
                          allowOutsideClick: false,
                          didOpen: () => { Swal.showLoading(); }
                        });
                        // Debug: tampilkan data yang dikirim
                        for (let pair of formData.entries()) {
                          console.log(pair[0]+ ': ' + pair[1]);
                        }
                        fetch('<?= base_url('booking/booking_travel_bandara_pickup') ?>', {
                          method: 'POST',
                          body: formData
                        })
                        .then(response => response.text())
                        .then(html => {
                          let success = false;
                          let message = 'Booking berhasil disimpan!';
                          if (html.includes('Booking berhasil disimpan')) {
                            success = true;
                          } else if (html.includes('Gagal menyimpan booking')) {
                            // Ambil pesan error detail jika ada
                            const match = html.match(/Gagal menyimpan booking\.(.*)/);
                            if (match && match[1]) {
                              message = 'Gagal menyimpan booking.' + match[1];
                            } else {
                              message = 'Gagal menyimpan booking.';
                            }
                          }
                          Swal.fire({
                            icon: success ? 'success' : 'error',
                            title: success ? 'Sukses!' : 'Gagal!',
                            text: message,
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                          if (success) bandaraPickupForm.reset();
                        })
                        .catch(() => {
                          Swal.fire({
                            icon: 'error',
                            title: 'Terjadi Kesalahan!',
                            text: 'Terjadi kesalahan. Silakan coba lagi.',
                            confirmButtonText: 'OK',
                            confirmButtonColor: '#0D83FD'
                          });
                        })
                        .finally(() => {
                          submitBtn.textContent = originalText;
                          submitBtn.disabled = false;
                        });
                      });
                    }
                  
                    // Aktifkan tab terakhir yang dipilih jika ada di localStorage
                    var lastTab = localStorage.getItem('activeBookingTab');
                    if (lastTab) {
                      var tabTrigger = document.querySelector('button[data-bs-target="' + lastTab + '"]');
                      if (tabTrigger) {
                        var tab = new bootstrap.Tab(tabTrigger);
                        tab.show();
                      }
                    }
                  
                    // Simpan tab yang dipilih ke localStorage saat tab di-click
                    var tabButtons = document.querySelectorAll('#bookingTab button[data-bs-toggle="tab"]');
                    tabButtons.forEach(function (btn) {
                      btn.addEventListener('shown.bs.tab', function (event) {
                        localStorage.setItem('activeBookingTab', event.target.getAttribute('data-bs-target'));
                      });
                    });
                  });
               </script>
            </div>
         </div>
      </div>
   </div>
</section>
